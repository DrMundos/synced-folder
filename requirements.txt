ğŸ“‹ Project Overview
This is a file synchronization system built in Python, designed as a local Dropbox-like service with client-server architecture. The project includes monitoring with Prometheus and Grafana, and uses Docker for easy deployment.
ğŸ—ï¸ Architecture Components
1. Server (server/server.py)
The HTTP server that manages file storage and synchronization.
Key Functions:
get_db(retries=10, delay=3): Establishes PostgreSQL connection with retry logic for database reliability.
init_db(): Creates the files_log table in PostgreSQL to track all sync operations (uploads, deletes, versions, hashes).
log_to_db(action, path, version=None, sha=None): Records sync events in the database for monitoring and auditing.
sha256_of_file(path): Calculates SHA256 hash of files for integrity checking (used by both client and server).
load_index(): Loads the file index from .index.json in the storage directory.
save_index(idx): Persists the file index to disk.
refresh_index(idx): Rebuilds the file index by scanning the storage directory and updating hashes/versions.
HTTP Handler Class (Handler):
_send_json(obj, code=200): Utility to send JSON responses with proper headers.
_track(method, endpoint, start): Records HTTP request metrics for Prometheus monitoring.
do_GET(): Handles GET requests for:
/index: Returns current file index with metadata
/download?path=...: Downloads specific files
/logs: Returns recent sync activity from database
do_POST(): Handles POST requests for:
/upload: Receives file uploads with conflict detection
/delete: Removes files from server storage
main(): Server entry point that initializes storage, database, starts metrics server, and runs the HTTP server.
2. Client (client/client.py)
The client that monitors local directories and syncs with the server.
Key Functions:
sha256_of_file(path): Same as server - calculates file hashes for comparison.
local_index(): Builds index of all local files with hashes and modification times.
Server Communication:
get_server_index(): Fetches current file index from server.
download_file(path): Downloads missing or outdated files from server.
upload_file(path, base_sha): Uploads new/changed files to server with conflict detection.
delete_on_server(path): Notifies server to delete files that were removed locally.
State Management:
load_state(): Loads previous file list from .local_state.json to detect deletions.
save_state(files_list): Saves current file list for future comparison.
Sync Logic:
sync_once(): Main synchronization function that:
Detects locally deleted files and removes them from server
Uploads new or modified local files
Downloads missing or outdated files from server
Updates local state tracking
main(): Client entry point that runs continuous sync loop every SCAN_INTERVAL seconds.
3. Configuration (config/settings.py)
Central configuration management using environment variables.
Database Settings:
PostgreSQL connection parameters (host, database, user, password)
Server Settings:
Host/port configuration for the sync server
Prometheus metrics port
Client Settings:
Local sync directory path
Scan interval for checking changes
State file location
4. Monitoring & Observability
Prometheus Metrics (in server):
UPLOADS: Counter for total uploaded files
DELETES: Counter for total deleted files
REQUESTS: Counter for HTTP requests by method/endpoint
LATENCY: Histogram for request response times
Grafana Dashboards:
Visualizes sync activity over time
Shows upload/delete statistics
Charts activity trends from PostgreSQL data
5. Docker Deployment (docker-compose.yml)
Multi-container setup including:
PostgreSQL: Database for sync logs
Server: Python HTTP server with metrics
Client: File watcher and sync client
Grafana: Dashboard visualization
Prometheus: Metrics collection
Postgres Exporter: Database metrics
ğŸ”§ Core Synchronization Algorithm
Client scans local directory and builds file index with SHA256 hashes
Compares with server index to detect changes
Uploads new/modified files with version conflict detection
Downloads missing/outdated files from server
Propagates local deletions to server
Tracks state to detect file deletions between scans
ğŸ§ª Testing
Current State: No test files are present in the project. The requirements.txt includes pytest==8.3.2 for testing, but no actual test suites exist.
Recommended Test Coverage:
Unit tests for sha256_of_file() function
Integration tests for upload/download operations
Mock tests for HTTP server endpoints
Conflict resolution testing
Database logging verification
ğŸ“Š Key Features
âœ… Automatic bidirectional sync between client and server
âœ… Conflict detection with timestamp-based resolution
âœ… Version tracking with SHA256 integrity checks
âœ… Deletion propagation in both directions
âœ… Database logging of all operations
âœ… Prometheus metrics for monitoring
âœ… Grafana dashboards for visualization
âœ… Docker containerization for easy deployment
âœ… Standard library core (no external deps for sync logic)
âš ï¸ Limitations (as noted in README)
No authentication or encryption
No large file chunking
No distributed conflict resolution
Simplified demo implementation
ğŸš€ Usage
The system runs via Docker Compose with all services orchestrated together. Files placed in the client's synced/ directory automatically sync to the server's storage/ folder, with full monitoring and visualization capabilities.
This is a well-architected educational project demonstrating real-world distributed systems concepts like file synchronization, conflict resolution, monitoring, and container orchestration.


ğŸ—ï¸ Project Hierarchy Structure
synced-folder/â”œâ”€â”€ ğŸ“ client/â”‚   â””â”€â”€ client.py              # Client-side sync logicâ”œâ”€â”€ ğŸ“ config/â”‚   â”œâ”€â”€ __init__.py           # Package initializationâ”‚   â””â”€â”€ settings.py           # Configuration managementâ”œâ”€â”€ ğŸ“ server/â”‚   â””â”€â”€ server.py             # Server-side HTTP handlerâ”œâ”€â”€ ğŸ“ grafana/â”‚   â”œâ”€â”€ ğŸ“ dashboards/â”‚   â”‚   â”œâ”€â”€ sync_dashboard.json       # Grafana dashboard configâ”‚   â”‚   â””â”€â”€ synced-folder-metrics.json # Metrics visualizationâ”‚   â””â”€â”€ ğŸ“ provisioning/â”‚       â”œâ”€â”€ ğŸ“ dashboards/â”‚       â”‚   â””â”€â”€ dashboard.yml         # Dashboard provisioningâ”‚       â””â”€â”€ ğŸ“ datasources/â”‚           â””â”€â”€ datasource.yml        # Data source configurationâ”œâ”€â”€ ğŸ“ prometheus/â”‚   â””â”€â”€ prometheus.yml         # Prometheus scraping configâ”œâ”€â”€ docker-compose.yml         # Multi-container orchestrationâ”œâ”€â”€ Dockerfile                 # Container build instructionsâ”œâ”€â”€ requirements.txt           # Python dependenciesâ”œâ”€â”€ README.md                  # Project documentationâ””â”€â”€ LICENSE                    # MIT License
ğŸ”„ System Flow Architecture
High-Level Data Flow
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚   Local Files   â”‚â”€â”€â”€â”€â”‚   Sync Client    â”‚â”€â”€â”€â”€â”‚   HTTP Server   â”‚â”‚   (synced/)     â”‚    â”‚   (client.py)    â”‚    â”‚   (server.py)   â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚                       â”‚                       â”‚         â”‚                       â”‚                       â”‚         â–¼                       â–¼                       â–¼â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚  File Changes   â”‚â”€â”€â”€â”€â”‚  Sync Operations â”‚â”€â”€â”€â”€â”‚   Storage       â”‚â”‚  Detection      â”‚    â”‚  (Upload/Downloadâ”‚    â”‚   (storage/)    â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   /Delete)       â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚                                                       â”‚                                                       â–¼                                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                            â”‚   PostgreSQL    â”‚                                            â”‚   (files_log)   â”‚                                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                       â”‚                                                       â–¼                                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                            â”‚   Monitoring    â”‚                                            â”‚ Prometheus +    â”‚                                            â”‚   Grafana       â”‚                                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
ğŸ“‹ Detailed Component Flow
1. Client Synchronization Flow
Client Startup     â†“Initialize Local Directory (synced/)     â†“â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚         Continuous Loop             â”‚â”‚  (Every SCAN_INTERVAL seconds)      â”‚â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚                                     â”‚â”‚  1. Get Server Index (/index)      â”‚â”‚     â†“                              â”‚â”‚  2. Build Local Index              â”‚â”‚     â†“                              â”‚â”‚  3. Detect Deletions               â”‚â”‚     (prev_files - curr_files)       â”‚â”‚     â†“                              â”‚â”‚  4. Delete on Server (/delete)     â”‚â”‚     â†“                              â”‚â”‚  5. Upload Changes (/upload)       â”‚â”‚     â†“                              â”‚â”‚  6. Download Missing (/download)   â”‚â”‚     â†“                              â”‚â”‚  7. Update Local State             â”‚â”‚                                     â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â†“Wait SCAN_INTERVAL seconds     â†“Repeat
2. Server Request Processing Flow
HTTP Request Received     â†“Route Determination     â†“â”œâ”€â”€ GET /indexâ”‚   â†“â”‚   Refresh File Indexâ”‚   â†“â”‚   Return JSON Indexâ”‚â”œâ”€â”€ GET /download?path=Xâ”‚   â†“â”‚   Validate Path Securityâ”‚   â†“â”‚   Stream File Contentâ”‚â”œâ”€â”€ GET /logsâ”‚   â†“â”‚   Query PostgreSQLâ”‚   â†“â”‚   Return Activity Logsâ”‚â”œâ”€â”€ POST /uploadâ”‚   â†“â”‚   Parse Metadata + Dataâ”‚   â†“â”‚   Conflict Detectionâ”‚   â†“â”‚   Save File + Update Indexâ”‚   â†“â”‚   Log to Databaseâ”‚â””â”€â”€ POST /delete    â†“    Validate Path    â†“    Remove File    â†“    Update Index    â†“    Log to Database
3. Conflict Resolution Flow
File Upload Request     â†“Extract base_sha from metadata     â†“Check if file exists on server     â†“â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚          Server File Exists?        â”‚â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚                                     â”‚â”‚  YES: Compare base_sha with         â”‚â”‚       current server sha            â”‚â”‚       â†“                             â”‚â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚â”‚       â”‚   SHAs Match?           â”‚   â”‚â”‚       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚â”‚       â”‚                         â”‚   â”‚â”‚       â”‚  YES: Normal Upload     â”‚   â”‚â”‚       â”‚                         â”‚   â”‚â”‚       â”‚  NO:  Create Conflict   â”‚   â”‚â”‚       â”‚       File (timestamped)â”‚   â”‚â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚â”‚                                     â”‚â”‚  NO:  Normal Upload (new file)     â”‚â”‚                                     â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
4. Monitoring & Metrics Flow
Sync Operation     â†“Server Processes Request     â†“Update Prometheus Counters     â†“Log to PostgreSQL (files_log)     â†“â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚         Prometheus Scrapes         â”‚â”‚         Server Metrics             â”‚â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚                                     â”‚â”‚  â€¢ sync_uploads_total              â”‚â”‚  â€¢ sync_deletes_total              â”‚â”‚  â€¢ sync_requests_total             â”‚â”‚  â€¢ sync_request_duration_seconds   â”‚â”‚                                     â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â†“Grafana Queries PostgreSQL     â†“Visualize in Dashboard
ğŸ”— Component Dependencies
Docker Compose     â†“â”œâ”€â”€ PostgreSQL Containerâ”‚   â†“â”‚   â””â”€â”€ Server (depends_on postgres)â”‚       â†“â”‚       â”œâ”€â”€ Client (depends_on server)â”‚       â”œâ”€â”€ Prometheus (depends_on server)â”‚       â””â”€â”€ Grafana (depends_on prometheus)â”‚â”œâ”€â”€ Postgres Exporter (depends_on postgres)â””â”€â”€ Grafana (depends_on prometheus)
ğŸ“Š Data Flow Between Components
File Synchronization Data Flow:
Client â†’ Server (Upload):
   Local File â†’ SHA256 Hash â†’ HTTP POST /upload â†’    Server Validation â†’ Conflict Check â†’ File Storage â†’    Index Update â†’ Database Log â†’ Metrics Update
Server â†’ Client (Download):
   Server Index â†’ HTTP GET /download â†’ File Stream â†’    Local Storage â†’ State Update
Client â†’ Server (Deletion):
   Local Deletion Detection â†’ HTTP POST /delete â†’    Server File Removal â†’ Index Update â†’ Database Log
ğŸ§© Key Design Patterns
Observer Pattern (Client)
Client continuously observes local directory changes
Periodically polls server for index updates
Repository Pattern (Server)
File index acts as in-memory repository
PostgreSQL serves as persistent audit log
Mediator Pattern (HTTP Server)
Server mediates communication between multiple clients
Handles conflict resolution and version management
Strategy Pattern (Sync Logic)
Different sync strategies for upload/download/delete
Pluggable conflict resolution mechanisms
ğŸ”„ State Management
Client State:
.local_state.jsonâ”œâ”€â”€ files: [list of current files]â””â”€â”€ Used to detect deletions between scans
Server State:
.index.jsonâ”œâ”€â”€ file_path: {â”‚   â”œâ”€â”€ sha: "hash_value"â”‚   â”œâ”€â”€ mtime: timestampâ”‚   â””â”€â”€ version: integerâ””â”€â”€ }
Database State:
files_log tableâ”œâ”€â”€ id (SERIAL)â”œâ”€â”€ action ('upload'|'delete')â”œâ”€â”€ path (TEXT)â”œâ”€â”€ version (INT, nullable)â”œâ”€â”€ sha (TEXT, nullable)â””â”€â”€ timestamp (TIMESTAMP)
This hierarchical structure and flow shows how your Synced Folder project implements a robust file synchronization system with monitoring capabilities. The design follows clean separation of concerns with the client handling local file watching, the server managing storage and conflict resolution, and the monitoring stack providing observability.
